# =============================================================================
# GitHub Actions å·¥ä½œæµï¼šè‡ªåŠ¨æ¯æ—¥è´¡çŒ®
# æ–‡ä»¶åï¼š.github/workflows/daily-commit.yml
# åŠŸèƒ½ï¼šæ¯å¤©è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶å¹¶æäº¤ï¼Œä¿æŒGitHubè´¡çŒ®å›¾æ´»è·ƒ
# =============================================================================

# -----------------------------------------------------------------------------
# ç¬¬ä¸€éƒ¨åˆ†ï¼šå·¥ä½œæµåç§°å’Œè§¦å‘æ¡ä»¶
# -----------------------------------------------------------------------------

name: Daily Green Wall

# è§¦å‘æ¡ä»¶å®šä¹‰
on:
  # schedule: å®šæ—¶è§¦å‘
  schedule:
    # cronè¡¨è¾¾å¼ï¼šåˆ†é’Ÿ å°æ—¶ æ—¥ æœˆ æ˜ŸæœŸ
    # '0 0 * * *' = æ¯å¤©UTC 00:00ï¼ˆåŒ—äº¬æ—¶é—´08:00ï¼‰
    - cron: '0 0 * * *'
    
    # å¯é€‰ï¼šæ·»åŠ ç¬¬äºŒä¸ªæ—¶é—´ç‚¹å¢åŠ éšæœºæ€§
    # - cron: '0 8 * * *'  # åŒ—äº¬æ—¶é—´16:00
  
  # workflow_dispatch: æ‰‹åŠ¨è§¦å‘ï¼ˆé‡è¦ï¼ç”¨äºæµ‹è¯•ï¼‰
  workflow_dispatch:

# -----------------------------------------------------------------------------
# ç¬¬äºŒéƒ¨åˆ†ï¼šæƒé™é…ç½®
# -----------------------------------------------------------------------------

# è®¾ç½®GITHUB_TOKENçš„æƒé™
permissions:
  contents: write  # å…è®¸å†™å…¥ä»“åº“å†…å®¹ï¼ˆæäº¤ä»£ç ï¼‰

# -----------------------------------------------------------------------------
# ç¬¬ä¸‰éƒ¨åˆ†ï¼šä»»åŠ¡å®šä¹‰
# -----------------------------------------------------------------------------

jobs:
  # ä»»åŠ¡IDï¼šdaily-contribution
  daily-contribution:
    # è¿è¡Œç¯å¢ƒï¼šæœ€æ–°ç‰ˆUbuntu
    runs-on: ubuntu-latest
    
    # æ‰§è¡Œæ­¥éª¤åˆ—è¡¨
    steps:
      
      # -------------------------------------------------
      # æ­¥éª¤1ï¼šæ£€å‡ºä»£ç ï¼ˆä¸‹è½½ä»“åº“åˆ°è™šæ‹Ÿæœºï¼‰
      # -------------------------------------------------
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„GITHUB_TOKENè¿›è¡Œè®¤è¯
          token: ${{ secrets.GITHUB_TOKEN }}
          # è·å–å®Œæ•´å†å²è®°å½•ï¼ˆå¯é€‰ï¼Œç”¨äºæŸäº›æ“ä½œï¼‰
          fetch-depth: 0
      
      # -------------------------------------------------
      # æ­¥éª¤2ï¼šé…ç½®Gitç”¨æˆ·ä¿¡æ¯
      # -------------------------------------------------
      - name: Setup Git identity
        run: |
          # é…ç½®æäº¤è€…å§“åï¼ˆæ˜¾ç¤ºåœ¨è´¡çŒ®å›¾ä¸­ï¼‰
          git config --global user.name "github-actions[bot]"
          # é…ç½®æäº¤è€…é‚®ç®±ï¼ˆGitHubæä¾›çš„ä¸“ç”¨é‚®ç®±ï¼‰
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
      
      # -------------------------------------------------
      # æ­¥éª¤3ï¼šç”Ÿæˆæ¯æ—¥æ›´æ–°å†…å®¹
      # -------------------------------------------------
      - name: Generate daily content
        run: |
          # åˆ›å»ºæ—¥å¿—ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
          mkdir -p logs
          
          # è·å–å½“å‰æ—¥æœŸæ—¶é—´
          CURRENT_DATE=$(date '+%Y-%m-%d')
          CURRENT_TIME=$(date '+%H:%M:%S')
          WEEKDAY=$(date '+%A')
          TIMESTAMP=$(date '+%s')
          
          # ç”Ÿæˆéšæœºæ•°ï¼ˆå¢åŠ å†…å®¹å˜åŒ–ï¼‰
          RANDOM_ID=$((RANDOM % 9000 + 1000))
          
          # åˆ›å»ºæ¯æ—¥æ—¥å¿—æ–‡ä»¶
          cat > "logs/${CURRENT_DATE}.md" << EOF
          # ğŸ“… Daily Activity Log
          
          **Date**: ${CURRENT_DATE} (${WEEKDAY})
          **Time**: ${CURRENT_TIME} UTC
          **Timestamp**: ${TIMESTAMP}
          **Status**: âœ… Active
          
          ## Activity ID
          ${RANDOM_ID}
          
          ## Notes
          Automated daily contribution to maintain consistency.
          
          ---
          *Generated by GitHub Actions*
          EOF
          
          # åŒæ—¶æ›´æ–°ä¸»è®°å½•æ–‡ä»¶ï¼ˆç”¨äºå¿«é€ŸæŸ¥çœ‹ï¼‰
          echo "Last Active: ${CURRENT_DATE} ${CURRENT_TIME} UTC" > LAST_ACTIVE
          echo "Total Runs: ${TIMESTAMP}" >> LAST_ACTIVE
          
          # è¾“å‡ºä¿¡æ¯åˆ°æ—¥å¿—ï¼ˆå¯åœ¨Actionsæ—¥å¿—ä¸­æŸ¥çœ‹ï¼‰
          echo "âœ… Generated file: logs/${CURRENT_DATE}.md"
          echo "âœ… Updated: LAST_ACTIVE"
      
      # -------------------------------------------------
      # æ­¥éª¤4ï¼šæäº¤å¹¶æ¨é€æ›´æ”¹
      # -------------------------------------------------
      - name: Commit and push
        run: |
          # è·å–å½“å‰æ—¥æœŸç”¨äºæäº¤ä¿¡æ¯
          DATE=$(date '+%Y-%m-%d')
          
          # æ·»åŠ æ‰€æœ‰æ›´æ”¹åˆ°æš‚å­˜åŒº
          git add .
          
          # æäº¤æ›´æ”¹ï¼ˆå¦‚æœæ²¡æœ‰ä»»ä½•æ›´æ”¹ï¼Œ||åé¢çš„å‘½ä»¤é˜²æ­¢æŠ¥é”™ï¼‰
          git commit -m "chore: daily update for ${DATE} [skip ci]" || echo "No changes to commit"
          
          # æ¨é€åˆ°è¿œç¨‹ä»“åº“
          git push origin main || echo "Nothing to push"
      
      # -------------------------------------------------
      # æ­¥éª¤5ï¼šéªŒè¯ç»“æœï¼ˆå¯é€‰ï¼‰
      # -------------------------------------------------
      - name: Verify contribution
        run: |
          echo "ğŸ‰ Daily contribution completed!"
          echo "ğŸ“Š Check your profile: https://github.com/${{ github.actor }}"
